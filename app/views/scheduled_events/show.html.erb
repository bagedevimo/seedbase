<% if @event.banner.attached? %>
  <div class="banner" style="background-image: url('<%= url_for(@event.banner) %>');"></div>
<% else %>
  <div class="banner"></div>
<% end %>
<div class="width-constraint grid-event">
  <% if current_user_organiser_for?(@event) %>
  <div class="management">
    <span>You're an organiser for <%= @event.name %>.</span>
    <%= link_to "Manage", edit_scheduled_event_path(@event, @scheduled_event), class: "button" %>
    <%= link_to "Your events", edit_event_path(@event), class: "button" %>
  </div>
  <% end %>

  <div class="surface event-control-bar">
    <div class="event-avatar"></div>
    <div class="control-bar-details">
      <div>
        Starts at <%= @scheduled_event.starts_at.strftime("%l:%M%P %A #{@scheduled_event.starts_at.day.ordinalize} %B %Y") %><br />
        Runs for <%= distance_of_time_in_words(@scheduled_event.duration) %>
      </div>

      <% if current_competitor %>
      <%= form_with url: competitor_path(current_competitor), local: true, method: :delete do |f| %>
      <%= f.button "Attending", class: "button stateful active affirmative", data: { action: "Leave" } %>
      <% end %>
      <% else %>
      <%= form_with url: competitors_path, local: true do |f| %>
      <%= f.hidden_field :scheduled_event, value: @scheduled_event.id %>
      <%= f.button "Attend" %>
      <% end %>
      <% end %>
    </div>
  </div>

  <div class="surface main">
    <div class="content">
      <h1><%= @event.name %></h1>
      <div class="subheading">
        <%= @scheduled_event.location_text %>
      </div>

      <p></p>

      <section>
        <h1>Teams</h1>

        <p></p>

        <% if current_competitor&.team %>
        <p>You're competiting in team <%= current_competitor.team.name %></p>
        <% else %>
        <p>Create a team</p>

        <%= form_with model: @scheduled_event.teams.new, url: new_team_path, local: true do |f| %>
        <%= f.text_field :name, placeholder: "Team name" %>
        <%= f.button "Create team" %>
        <% end %>
        <% end %>
      </section>
    </div>
  </div>

  <aside class="surface">
    <%= content_tag 'div', '', class: "map", data: {lat: @scheduled_event.lat, long: @scheduled_event.long} %>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiBkB9k8UQh4nAS8X9LrEYfNn25MnwGZY&callback=initMap"></script>
  </aside>
</div>
